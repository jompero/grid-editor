(this["webpackJsonpgrid-editor-client"]=this["webpackJsonpgrid-editor-client"]||[]).push([[0],{122:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(9),l=n.n(i),c=n(6),o=n(23),u=n(88),m={tileMap:{name:"New Map",width:16,height:16,tileMap:[]},history:[new Array(256).fill(-1)],current:0},s=function(e){return{tileMap:e,history:[e.tileMap],current:0}};function d(e,t,n){var a=e.history[e.current].map((function(e,a){return a===t?n:e})),r=[].concat(Object(u.a)(e.history.slice(0,e.current+1)),[a]),i=e.current+1;return Object(o.a)({},e,{history:r,current:i})}function p(e){return{type:"LOAD_MAP",data:{tileMap:e}}}function f(e){return{type:"UPDATE_MAP",data:{tileMap:e}}}var h=function(){var e,t,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case"LOAD_MAP":return(null===(e=r.data)||void 0===e?void 0:e.tileMap)?s(r.data.tileMap):a;case"SET_TILE":return(null===(t=r.data)||void 0===t?void 0:t.target)?d(a,r.data.target.index,r.data.target.tile):a;case"UNDO":return 0===a.current?a:(console.log("didnt undo"),Object(o.a)({},a,{current:a.current-1}));case"REDO":return a.current===a.history.length-1?a:Object(o.a)({},a,{current:a.current+1});case"UPDATE_MAP":var i=null===(n=r.data)||void 0===n?void 0:n.tileMap;if(!i)return a;console.log("updating tilemap",i);var l=a.history,c=a.current;return i.width===a.tileMap.width&&i.height===a.tileMap.height||(l=[new Array(i.width*i.height).fill(-1)],c=0),Object(o.a)({},a,{tileMap:i,history:l,current:c});default:return a}},g=n(149),E=n(169);var v=function(e){var t=e.children,n=e.columns,r=e.rows,i=e.tileHeight,l=e.tileWidth,c=e.scale,o=Object(g.a)((function(e){return Object(E.a)({gridContainer:{display:"inline-grid",gridTemplateColumns:"repeat(".concat(n,", ").concat(l*c,"px [col-start])"),gridTemplateRows:"repeat(".concat(r,", ").concat(i*c,"px [row-start])")},children:{transformOrigin:"top left",transform:"scale(".concat(c,")"),"&:hover":{cursor:"pointer"}}})}))();return a.createElement("div",{className:o.gridContainer},t?a.Children.map(t,(function(e){return a.createElement("div",{className:o.children},e)})):null)};var b,O=function(e){var t=e.image,n=e.color,r=e.posX,i=e.posY,l=e.width,c=e.height,o=Object(g.a)((function(e){return Object(E.a)({tile:{backgroundImage:"url(".concat(t,")"),backgroundColor:"".concat(n),backgroundPosition:"-".concat(r,"px -").concat(i,"px"),width:l,height:c,imageRendering:"pixelated"}})}))();return a.createElement("div",{className:o.tile})};function A(e){if(b&&b.tileSet===e)return b.tilesPerRow;var t=Math.floor(e.imageWidth/e.tileWidth);return b={tileSet:e,tilesPerRow:t,mapping:[]},t}function j(e){return Math.floor(e.imageHeight/e.tileHeight)}function w(e){return Math.floor(e/b.tilesPerRow)*b.tileSet.tileHeight}function C(e){return e%b.tilesPerRow*b.tileSet.tileWidth}var y=function(e,t){return A(t),function(e){b.mapping[e]||(b.mapping[e]={posY:w(e),posX:C(e)}),b.mapping[e]}(e),{image:t.image,posX:b.mapping[e].posX,posY:b.mapping[e].posY,width:t.tileWidth,height:t.tileHeight}};var M=function(){var e=Object(c.b)(),t=Object(c.c)((function(e){return e.canvas})),n=Object(c.c)((function(e){return e.tools.brush})),r=Object(c.c)((function(e){return e.tileSet}));function i(t){e(function(e,t){return{type:"SET_TILE",data:{target:{index:e,tile:t}}}}(t,n)),console.log("painting",n,"on",t)}return 0===t.tileMap.width?null:a.createElement(v,{columns:t.tileMap.width,rows:t.tileMap.height,tileHeight:r.tileHeight,tileWidth:r.tileWidth,scale:32/r.tileWidth},t.history[t.current].map((function(e,n){return a.createElement("div",{key:n,onMouseDown:function(){return i(n)},onMouseEnter:function(e){return 1===e.nativeEvent.which&&i(n)}},e>=0&&a.createElement(O,y(e,r)),-1===e&&a.createElement(O,function(e,t){return{color:(e%t+Math.floor(e/t))%2===0?"GREY":"WHITE",width:r.tileWidth,height:r.tileHeight}}(n,t.tileMap.width)))})))},k=n(168),S=n(152),N={brush:0};function x(e,t){return Object(o.a)({},e,{brush:t})}function P(e){return{type:"SET_BRUSH",data:{brush:e}}}var D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_BRUSH":return x(e,t.data.brush);default:return e}},W=n(74),B=n(75),H=n.n(B);var I=function(){var e=Object(c.b)();return r.a.createElement("div",null,r.a.createElement("div",{onClick:function(){return e(P(-1))}},r.a.createElement(S.a,null,r.a.createElement(W.Icon,{icon:H.a}))))},T=n(76),L=n.n(T);var R=function(){var e=Object(c.b)();return r.a.createElement("div",{onClick:function(){return e({type:"UNDO"})}},r.a.createElement(S.a,null,r.a.createElement(L.a,null)))},V=n(77),F=n.n(V);var G=function(){var e=Object(c.b)();return r.a.createElement(S.a,{onClick:function(){return e({type:"REDO"})}},r.a.createElement(F.a,null))},Q=n(47),U=n.n(Q),K="http://localhost:3001";function q(e){return e.id?U.a.put("".concat(K,"/api/maps/").concat(e.id),e).then((function(e){return console.log("maps",e),e.data})):U.a.post("".concat(K,"/api/maps"),e).then((function(e){return console.log("maps",e),e.data}))}function J(e){return U.a.delete("".concat(K,"/api/maps/").concat(e)).then((function(e){return console.log("deleted",e),e.data}))}var Y={getAll:function(){return U.a.get("".concat(K,"/api/maps")).then((function(e){return console.log("maps",e),e.data}))},saveMap:q,deleteMap:J},X=n(78),Z=n.n(X);var z=function(){var e,t,n,a,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1?arguments[1]:void 0;switch(i.type){case"SET_MAPS":return(null===(e=i.data)||void 0===e?void 0:e.maps)?i.data.maps:r;case"DELETE_MAP":var l=null===(t=i.data)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.id;return l?r.filter((function(e){return e.id!==l})):r;case"SAVE_MAP":var c=null===(a=i.data)||void 0===a?void 0:a.map;if(c){var o=r.reduce((function(e,t,n){return t.id===c.id?n:e}),-1);return o>=0?r.map((function(e,t){return t===o?c:e})):r.concat(c)}return r;default:return r}};var _=function(){var e=Object(c.b)(),t=Object(c.c)((function(e){return e.canvas})),n=Object(c.c)((function(e){return e.user.token})),a=Object(o.a)({},t.tileMap,{tileMap:t.history[t.current]});return n?r.a.createElement(S.a,{onClick:function(){q(a).then((function(t){console.log("map saved",t),e(f(t)),e(function(e){return{type:"SAVE_MAP",data:{map:e}}}(t))}))}},r.a.createElement(Z.a,null)):null},$=n(24),ee=n(80),te=n.n(ee);var ne=function(){var e=Object($.f)();return r.a.createElement(S.a,{onClick:function(){return e.push("/maps")}},r.a.createElement(te.a,null))},ae=n(22),re=n(167),ie=Object(g.a)((function(e){return Object(E.a)({window:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",transformOrigin:"center"}})}));var le=function(){var e=ie(),t=Object(c.b)(),n=Object(c.c)((function(e){return e.tileSet})),r=Object(c.c)((function(e){return e.tools.brush})),i=a.useState(!1),l=Object(ae.a)(i,2),o=l[0],u=l[1];return a.createElement("div",null,a.createElement("div",{id:"selectedBrush",onClick:function(){return u(!0)}},a.createElement(S.a,null,a.createElement(v,{columns:1,rows:1,tileHeight:n.tileHeight,tileWidth:n.tileWidth,scale:24/n.tileWidth},r>=0&&a.createElement(O,y(r,n))))),a.createElement("div",{onClick:function(){return u(!1)}},a.createElement(re.a,{open:o,onClose:function(){return u(!1)}},a.createElement("div",{className:e.window},a.createElement(v,{columns:A(n),rows:j(n),tileHeight:n.tileHeight,tileWidth:n.tileWidth,scale:32/n.tileWidth},Array(n.tiles).fill(0).map((function(e,r){return a.createElement("div",{key:r,onClick:function(){return t(P(r))}},a.createElement(O,y(r,n)))})))))))},ce=n(154),oe=n(155),ue=[r.a.createElement(ne,null),r.a.createElement(_,null),r.a.createElement(R,null),r.a.createElement(G,null),r.a.createElement(I,null),r.a.createElement(le,null)];var me=function(){return r.a.createElement(ce.a,{id:"tools"},ue.map((function(e,t){return r.a.createElement(oe.a,{key:t},e)})))},se=Object(g.a)((function(e){return Object(E.a)({root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},drawer:{flexShrink:0},title:{flexGrow:1},tool:{marginRight:"1em"},content:{margin:"auto"},toolbarMargin:e.mixins.toolbar})}));var de=function(e){var t=e.children,n=Object(c.c)((function(e){return e.tools.brush}));console.log("brush",n);var a=se();return r.a.createElement("div",{className:a.root},r.a.createElement("div",{className:a.content},r.a.createElement(k.a,{variant:"permanent"},r.a.createElement("div",{className:a.toolbarMargin}),r.a.createElement(me,null)),r.a.createElement("div",{className:a.content},t)))},pe=n(28),fe=n(156),he=n(157),ge=n(158),Ee=n(159),ve=n(160),be=n(161),Oe=n(162),Ae=Object(g.a)((function(e){return Object(E.a)({map:{margin:"1em"},mapThumbnail:{display:"flex",height:"10em",overflow:"hidden",alignItems:"center",justifyContent:"center",margin:"0.5em"}})}));var je=function(e){var t=e.map,n=Object($.f)(),a=Object(c.c)((function(e){return e.tileSet})),i=Object(c.b)(),l=Ae();return r.a.createElement(fe.a,{className:l.map,key:t.name},r.a.createElement(he.a,{onClick:function(){return i(p(t)),void n.push("/")}},r.a.createElement(ge.a,null,r.a.createElement("div",{className:l.mapThumbnail},r.a.createElement(v,{rows:t.height,columns:t.width,tileHeight:a.tileHeight,tileWidth:a.tileWidth,scale:8/a.tileWidth},function(e){return e.tileMap.map((function(e,t){return r.a.createElement("div",{key:t},e>=0&&r.a.createElement(O,y(e,a)))}))}(t)))),r.a.createElement(Ee.a,null,r.a.createElement(ve.a,{variant:"h6"},t.name))),r.a.createElement(be.a,null,r.a.createElement(Oe.a,{component:pe.b,to:"/",onClick:function(){return i(p(t))}},"Load"),r.a.createElement(Oe.a,{onClick:function(){return function(e){i(function(e){return{type:"DELETE_MAP",data:{map:e}}}(e)),e.id&&J(e.id)}(t)}},"Delete")))},we=Object(g.a)((function(){return Object(E.a)({map:{margin:"1em"},mapList:{display:"flex"}})}));var Ce=function(){var e=Object(c.b)();Object(a.useEffect)((function(){e((function(e){Y.getAll().then((function(t){e({type:"SET_MAPS",data:{maps:t}})}))}))}),[e]);var t=Object(c.c)((function(e){return e.maps})),n=we();return a.createElement("div",{className:n.mapList},t.map((function(e){return a.createElement(je,{key:e.id,map:e})})))},ye=n(163),Me=n(164),ke=n(165),Se=n(83),Ne=n.n(Se),xe=n(166),Pe=Object(g.a)((function(e){return Object(E.a)({form:{display:"grid",gridGap:"2em",background:"white",padding:"2em"}})}));var De=function(){var e=Object(c.c)((function(e){return e.canvas.tileMap})),t=Object(c.b)(),n=Pe(),i=Object(a.useState)(e.name),l=Object(ae.a)(i,2),u=l[0],m=l[1],s=Object(a.useState)(e.width),d=Object(ae.a)(s,2),h=d[0],g=d[1],E=Object(a.useState)(e.height),v=Object(ae.a)(E,2),b=v[0],O=v[1];return r.a.createElement("div",{className:n.form},r.a.createElement(xe.a,{label:"Name",variant:"outlined",defaultValue:u,onChange:function(e){return m(e.target.value)}}),r.a.createElement(xe.a,{label:"Width",type:"number",variant:"outlined",defaultValue:h,onChange:function(e){return g(Number.parseInt(e.target.value))}}),r.a.createElement(xe.a,{label:"Height",type:"number",variant:"outlined",defaultValue:b,onChange:function(e){return O(Number.parseInt(e.target.value))}}),r.a.createElement(Oe.a,{type:"submit",variant:"contained",color:"primary",onClick:function(n){return function(n){n.preventDefault(),t(f(Object(o.a)({},e,{name:u,width:h,height:b})))}(n)}},"Save Changes"),r.a.createElement(Oe.a,{type:"submit",variant:"outlined",onClick:function(e){return function(e){e.preventDefault();var n={name:"New Map",width:h,height:b,tileMap:new Array(h*b).fill(-1)};t(p(n))}(e)}},"New"))},We=Object(g.a)((function(e){return Object(E.a)({window:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",transformOrigin:"center"}})}));var Be=function(){var e=Object(a.useState)(!1),t=Object(ae.a)(e,2),n=t[0],i=t[1],l=We();return r.a.createElement("div",null,r.a.createElement(S.a,{onClick:function(){return i(!0)}},r.a.createElement(Ne.a,null)),r.a.createElement(re.a,{open:n,onClose:function(){return i(!1)}},r.a.createElement("div",{className:l.window},r.a.createElement(De,null))))},He=n(84),Ie=n.n(He),Te=Object(g.a)((function(e){return Object(E.a)({root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},title:{flexGrow:1,"&:hover":{cursor:"pointer"}},content:{margin:"auto"},toolbarMargin:e.mixins.toolbar})}));var Le=function(e){var t=e.children,n=Object(c.c)((function(e){return e.canvas.tileMap.name})),a=Object($.f)(),i=Te();return r.a.createElement("div",{className:i.root},r.a.createElement(Me.a,{color:"default",position:"absolute",className:i.appBar},r.a.createElement(ke.a,null,r.a.createElement(ye.a,{container:!0,direction:"row",justify:"space-between",alignItems:"center"},r.a.createElement(ye.a,{item:!0,alignContent:"flex-start",xs:3},r.a.createElement(ve.a,{variant:"h6",className:i.title,onClick:function(){return a.push("/")}},"Grid Editor")),r.a.createElement(ye.a,{item:!0},r.a.createElement($.c,null,r.a.createElement($.a,{exact:!0,path:"/login"}),r.a.createElement($.a,{exact:!0,path:"/maps"},r.a.createElement(S.a,{onClick:function(){return a.push("/")}},r.a.createElement(Ie.a,null))),r.a.createElement($.a,{exact:!0,path:"/"},r.a.createElement(ye.a,{container:!0,alignItems:"center"},r.a.createElement(ye.a,{item:!0},r.a.createElement(Be,null)),r.a.createElement(ye.a,{item:!0},r.a.createElement(ve.a,{variant:"h6",display:"inline",align:"justify"},n)))))),r.a.createElement(ye.a,{item:!0,xs:3,justify:"flex-end",style:{textAlign:"right"}},r.a.createElement(Oe.a,{component:pe.b,to:"/login"},"Login"))))),r.a.createElement("div",{className:i.content},r.a.createElement("div",{className:i.toolbarMargin}),t))};var Re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":var n=t.data,a=n.username,r=n.token;return{username:a,token:r};default:return e}},Ve=Object(g.a)((function(e){return Object(E.a)({form:{display:"grid",gridGap:"2em",background:"white",padding:"2em"}})}));var Fe=function(){var e=Object(a.useState)(""),t=Object(ae.a)(e,2),n=t[0],i=t[1],l=Object(a.useState)(""),o=Object(ae.a)(l,2),u=o[0],m=o[1],s=Object(c.b)(),d=Object($.f)(),p=Ve();return r.a.createElement("form",{className:p.form},r.a.createElement(xe.a,{label:"Username",variant:"outlined",defaultValue:n,onChange:function(e){return i(e.target.value)}}),r.a.createElement(xe.a,{label:"Password",variant:"outlined",defaultValue:u,onChange:function(e){return m(e.target.value)}}),r.a.createElement(Oe.a,{onClick:function(){return s(function(e,t){return{type:"LOGIN",data:{username:e,token:t}}}(n,u)),void d.push("/")}},"Login"))};var Ge=function(){return a.createElement(pe.a,null,a.createElement(Le,null,a.createElement($.c,null,a.createElement($.a,{exact:!0,path:"/login"},a.createElement(Fe,null)),a.createElement($.a,{exact:!0,path:"/"},a.createElement(de,null,a.createElement(M,null))),a.createElement($.a,{path:"/maps"},a.createElement(Ce,null)))))},Qe=n(34),Ue=n(85),Ke=n(86),qe={City:{image:n.n(Ke).a,imageWidth:64,imageHeight:48,tileWidth:8,tileHeight:8,tiles:46}};var Je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qe.City,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TILESET":return t.data.tileSet;default:return e}},Ye=n(87),Xe=Object(Qe.combineReducers)({user:Re,tileSet:Je,canvas:h,tools:D,maps:z}),Ze=Object(Qe.createStore)(Xe,Object(Ue.composeWithDevTools)(Object(Qe.applyMiddleware)(Ye.a)));console.log("store",Ze.getState());var ze=Ze,_e=function(){return l.a.render(a.createElement(c.a,{store:ze},a.createElement(Ge,null)),document.getElementById("root"))};_e(),ze.subscribe(_e)},86:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAwCAYAAAChS3wfAAADTklEQVR42t2ZPU4dMRDHfS4K2kgUqRAFJ0gRiQ4pEg1HoKampSO5SNJQ0SRnoAN5pVn932S+bI/ZfSCN3u7a3vX8PDOeMeX8+v7Nkx8Pv95Ovn47kPosOlbqqz2PvOvl9c86j6fHO1Nw/O+Ls0XwWYl8GD9IUp/1TL5HcQ/Ay/PPVUhxuk4FcHP7fZEeABmCAGgeGgDJAqhPMwD8aJV63buKo8pLAGheVaa4AH6YlI8AsEzecwnebgFAs+eWgO8jAPi9MsOHrclnSA+AOubyy+ki6L5ltqnOEFK+1QLQgqcD4BOdIdznpVjgzbfQpLOVj+7TnuCqSlE+mgeQ+ZN8KgC8D3cBrjxCKK0ZnRcErSDlKSm1oVmTaXNFpwJoTWVnAJAUjAIgRSXl62/JTmgyAOC9BgAtglsJBkFUmtrw2S4A8ElrQCIAuBVo5r8C2GMQ5ECsFbYCYsgC9r4LtAKQAqa2+rWtYHk7UqpqACwIPKlB0ZIfbbzWb7EGLav8KABSBucpmiFhAJkl7kcBiI7fDED26vZCq+WvBqC2rQDQb+o1V8xrt4qhlslrfb13aG10BqBJGY3QkXL4YJ8OlLrRvpFy2QXgJQqeROoGnFzksCPa1xpPEDYB0HPkNevIrAY6TfklCFLyoP1mipSo/Pt75YrVj1xRu3Z3gWMHgO27ByABiQCIAlFrgxEA1sGEd3DhQRwFwMdzC6i/mAfgqfCaBxyjBWimL70Pgx4BONgFrNOWiGwNgAsH4wLARlKKd7LaZwdBSTEPAoqbB6CC0rXX3lLLj+4CGgDJDTAIunlAq797xMlS8EN0/1+U7kx3aaz2ruZdoMd/NXPT4oVkNSMAxG2PtVs1RW0ro0FM8jUPAEKIKtoKImrZJbrCxwRArS6FnWtTCzD9k/m691xzA5wvPx1OAYDHz1EAtW8UQEZc0ADUtmJtU5F9HP8D0wqg59BDWuVoPJCkeArOBNC6C1jR3nveBaDFAqQYoN1HEig0X1OB0b9sAN4JEgfgVaLSt3FsKoDeIEirK0VZKQr3ApBK9GkAonkAFkiovFY1Ur+e/w9K95tbAComrbZkFS0ArMVIAZBVC/QCiLjA1CCYXQ32mnZUcT6PNAB7FmsnGNX/HbosOX1WJujtAAAAAElFTkSuQmCC"},94:function(e,t,n){e.exports=n(122)}},[[94,1,2]]]);
//# sourceMappingURL=main.05f0a89c.chunk.js.map